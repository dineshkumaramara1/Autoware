<?xml version="1.0"?>

<launch>

  <!-- declare arguments with default values -->
  <arg name="pcap" default="" />
  <arg name="rpm" default="600.0" />
  <arg name="read_once" default="true" />
  <arg name="udp_timeout_ms" default="1000"/>
  <arg name="single_packet" default="true"/>
  <arg name="frame_id_left" default="velodyne_left" />
  <arg name="frame_id_right" default="velodyne_right" />
  
<!--
  <arg name="calibration" default="$(find velodyne_pointcloud)/params/VLP16db.yaml"/>
-->
  <arg name="min_range" default="0.3" />
  <arg name="max_range" default="100.0" />
  <arg name="frequency" default="10.0" />
  <arg name="publish_point_cloud" default="true" />
  
  <!-- start nodelet manager and driver nodelets -->
  <include file="$(find velodyne_driver)/launch/nodelet_manager_dual.launch">
    <arg name="model" value="VLP16"/>
    <arg name="pcap" value="$(arg pcap)"/>
    <arg name="rpm" value="$(arg rpm)"/>
    <arg name="udp_timeout_ms" value="$(arg udp_timeout_ms)"/>
    <arg name="single_packet" value="$(arg single_packet)"/>
  </include>
  
 <!-- start decoder nodelet -->
  <node pkg="nodelet" type="nodelet" name="velodyne_decoder_nodelet_left"
    args="load velodyne_decoder/VelodyneDecoderNodelet velodyne_nodelet_manager"
    output="screen">
    <param name="min_range" value="$(arg min_range)"/>
    <param name="max_range" value="$(arg max_range)"/>
    <param name="frequency" value="$(arg frequency)"/>
    <param name="frame_id" value="$(arg frame_id_left)"/>
    <param name="publish_point_cloud" value="$(arg publish_point_cloud)"/>
    <remap from="velodyne_packet" to="velodyne_packet_left" />
    <remap from="velodyne_point_cloud" to="velodyne_points_left" />
  </node>
  <node pkg="nodelet" type="nodelet" name="velodyne_decoder_nodelet_right"
    args="load velodyne_decoder/VelodyneDecoderNodelet velodyne_nodelet_manager"
    output="screen">
    <param name="min_range" value="$(arg min_range)"/>
    <param name="max_range" value="$(arg max_range)"/>
    <param name="frequency" value="$(arg frequency)"/>
    <param name="frame_id" value="$(arg frame_id_right)"/>
    <param name="publish_point_cloud" value="$(arg publish_point_cloud)"/>
    <remap from="velodyne_packet" to="velodyne_packet_right" />
    <remap from="velodyne_point_cloud" to="velodyne_points_right" />
  </node>

<node name="base_to_velodyne_right" pkg="tf2_ros" type="static_transform_publisher" args=" 0 0.9 0 0.8 0 0 base_link velodyne_right" />
<node name="base_to_velodyne_left" pkg="tf2_ros" type="static_transform_publisher" args=" 0 -0.9 0 -0.8 0 0 base_link velodyne_left" />





</launch>
